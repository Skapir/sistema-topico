{% extends 'base.html' %} {% block content %}
<div class="container mx-auto p-6">
    <!-- Título principal -->
    <div class="text-center bg-blue-600 text-white p-6 rounded-lg shadow-md">
        <h1 class="text-3xl font-bold">Kardex de Materiales</h1>
    </div>

    <!-- Selección de material -->
    <div class="bg-white p-6 rounded-xl shadow-lg mt-8">
        <form method="GET" action="" class="flex flex-col md:flex-row items-center justify-center gap-4">
            <label for="tipo-material" class="font-semibold text-lg text-gray-700">
                Seleccione el tipo de material:
            </label>
            <select id="tipo-material" name="material_id" class="w-full md:w-1/3 border border-gray-300 rounded-lg px-4 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="" disabled selected>-- Seleccione un material --</option>
                {% for material in materiales %}
                <option value="{{ material.id }}" {% if material_seleccionado and material.id == material_seleccionado.id %}selected{% endif %}>
                    {{ material.descripcion }}
                </option>
                {% endfor %}
            </select>
            <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 transition-all">
                Buscar
            </button>
        </form>
        <!-- Exportar botones -->
        {% if registros %}
        <div style="text-align: center; margin-top: 20px;">
            <form method="GET" action="{% url 'export_kardex_excel' %}" style="display: inline;">
                <input type="hidden" name="material_id" value="{{ material_seleccionado.id }}">
                <button type="submit" style="padding: 10px 20px; font-size: 14px; margin: 5px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Exportar a Excel
                </button>
            </form>
            <form method="GET" action="{% url 'export_kardex_pdf' %}" style="display: inline;">
                <input type="hidden" name="material_id" value="{{ material_seleccionado.id }}">
                <button type="submit" style="padding: 10px 20px; font-size: 14px; margin: 5px; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Exportar a PDF
                </button>
            </form>
        </div>
        {% endif %}
    </div>
    </div>

    

    <!-- Tabla de registros -->
    {% if registros %}
        <div class="overflow-x-auto bg-white rounded-xl shadow-lg">
        <h2 class="text-3xl font-bold text-blue-700 mb-8 text-center">Kardex del Material: {{ material_seleccionado.descripcion }}</h2>
        <br>
        <table class="table-auto w-full border-collapse">
          <thead class="bg-blue-600 text-white">
              <tr>
                  <th class="px-4 py-3 text-left font-semibold text-lg uppercase tracking-wide border-r border-blue-500">Fecha</th>
                  <th class="px-4 py-3 text-left font-semibold text-lg uppercase tracking-wide border-r border-blue-500">Tipo de Procedimiento</th>
                  <th class="px-4 py-3 text-left font-semibold text-lg uppercase tracking-wide border-r border-blue-500">Entrada</th>
                  <th class="px-4 py-3 text-left font-semibold text-lg uppercase tracking-wide border-r border-blue-500">Salida</th>
                  <th class="px-4 py-3 text-left font-semibold text-lg uppercase tracking-wide border-r border-blue-500">Saldo</th>
              </tr>
          </thead>
          <tbody>
              {% for registro in registros %}
                  <tr>
                      <td style="padding: 10px; border: 1px solid #ddd;">
                          {% if registro.fecha_registro == "Saldo Inicial" %}
                              <strong>{{ registro.fecha_registro }}</strong>
                          {% else %}
                              {{ registro.fecha_registro }}
                          {% endif %}
                      </td>
                      <td style="padding: 10px; border: 1px solid #ddd;">
                          {{ registro.tipo_procedimiento }}
                      </td>
                      <td style="padding: 10px; border: 1px solid #ddd;">
                          {{ registro.entrada }}
                      </td>
                      <td style="padding: 10px; border: 1px solid #ddd;">
                          {{ registro.salida }}
                      </td>
                      <td style="padding: 10px; border: 1px solid #ddd;">
                          {{ registro.saldo }}
                      </td>
                  </tr>
              {% endfor %}
          </tbody>
        </table>

    </div>
    {% elif material_seleccionado %}
    <p class="text-center text-gray-700 font-semibold mt-8">
        No hay registros para este material.
    </p>
    {% endif %}
</div>
{% endblock %}
