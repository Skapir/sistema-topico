{% extends "base.html" %}

{% block content %}

    {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
            <div
            class="alert {{ message.tags }} p-4 rounded-lg shadow-md text-white"
            style="{% if message.tags == 'success' %}background-color: #38a169;{% elif message.tags == 'error' %}background-color: #e53e3e;{% else %}background-color: #3182ce;{% endif %}"
            >
            {{ message }}
            </div>
        {% endfor %}
        </div>
    {% endif %}
<div class="container mx-auto px-4 py-6">
    <!-- Título -->
    <h1 class="text-2xl font-bold text-blue-700 mb-4">Atenciones de Pacientes</h1>

    <!-- Formulario de búsqueda -->
    <form method="POST" action="{% url 'consultar_atenciones_paciente' %}" class="flex items-center space-x-4 mb-6">
        {% csrf_token %}
        <input
            type="text"
            name="dni"
            placeholder="Ingrese DNI del paciente"
            value="{{ dni_paciente }}"
            class="border px-4 py-2 rounded-lg focus:ring-blue-300 w-full max-w-sm"
        />
        <select
            name="tipo_procedimiento"
            class="border px-4 py-2 rounded-lg focus:ring-blue-300 w-full max-w-sm"
        >
            <option value="">-- Todos los Tipos de Procedimientos --</option>
            {% for tipo in tipos_procedimiento %}
                <option
                    value="{{ tipo.id }}"
                    {% if tipo.id|stringformat:"s" == tipo_procedimiento_seleccionado %}
                        selected
                    {% endif %}
                >
                    {{ tipo.descripcion }}
                </option>
            {% endfor %}
        </select>
        <button
            type="submit"
            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-500"
        >
            Buscar
        </button>
    </form>
    <!-- Información del paciente -->
    {% if paciente %}
    <div class="bg-gray-100 p-4 rounded-lg mb-6">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">
            Atenciones de: {{ paciente.HI_NOMBRE }} (DNI: {{ paciente.HI_NDOCUM }})
        </h2>
    </div>
    {% endif %}
    <!-- Tabla de Atenciones -->
    <table class="table-auto w-full border-collapse">
        <thead>
            <tr class="bg-blue-600 text-white">
                <th class="border px-4 py-2">#</th>
                <th class="border px-4 py-2">Tipo Procedimiento</th>
                <th class="border px-4 py-2">Fecha</th>
                <th class="border px-4 py-2">Acción</th>
            </tr>
        </thead>
        <tbody>
            {% for atencion in atenciones %}
                <tr class="hover:bg-gray-100">
                    <td class="border px-4 py-2 text-center">{{ forloop.counter }}</td>
                    <td class="border px-4 py-2 text-center">{{ atencion.tipo_procedimiento.descripcion }}</td>
                    <td class="border px-4 py-2 text-center">{{ atencion.fecha_registro }}{{ atencion.fecha_atencion }}</td>
                    <td class="border px-4 py-2 text-center">
                        <button
                        type="button"
                        class="bg-green-700 text-white px-4 py-2 rounded-md hover:bg-green-500 transition-colors"
                        
                        ><a href="{% url 'generar_pdf_atencion' atencion.id atencion.tipo_procedimiento_nombre %}" target="_blank">Ver</a>                        
                        </button>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="4" class="text-center py-4 text-gray-600">
                        No se encontraron atenciones para este paciente.
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Paginación -->
    <div id="paginacion-container" class="mt-6 flex justify-center items-center gap-3 " >
        <!-- Botón "Anterior" -->
        {% if atenciones.has_previous %}
            <a href="?page={{ atenciones.previous_page_number }}&dni={{ dni_paciente }}&tipo_procedimiento={{ tipo_procedimiento_seleccionado }}"
            class="px-4 py-2 leading-tight text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-300 shadow-sm">
                Anterior
            </a>
        {% endif %}

        <!-- Números de página -->
        {% for num in atenciones.paginator.page_range %}
            <a href="?page={{ num }}&dni={{ dni_paciente }}&tipo_procedimiento={{ tipo_procedimiento_seleccionado }}"
            class="px-4 py-2 rounded-lg border border-gray-300 shadow-sm transition {% if num == atenciones.number %} bg-blue-500 text-white font-bold {% else %} bg-gray-200 text-gray-700 hover:bg-gray-300 {% endif %}">
                {{ num }}
            </a>
        {% endfor %}

        <!-- Botón "Siguiente" -->
        {% if atenciones.has_next %}
            <a href="?page={{ atenciones.next_page_number }}&dni={{ dni_paciente }}&tipo_procedimiento={{ tipo_procedimiento_seleccionado }}"
            class="px-4 py-2 leading-tight text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-300 shadow-sm">
                Siguiente
            </a>
        {% endif %}
    </div>

</div>
{% endblock %}